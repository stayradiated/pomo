// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator kysely {
  provider = "prisma-kysely"

  // Optionally provide a destination directory for the generated file
  // and a filename of your choice
  output   = "../src"
  fileName = "db.generated.ts"
  readOnlyIds = true
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Stream {
  id        Int       @id @default(autoincrement())
  name      String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
  pointList Point[]
}

model Point {
  id         Int          @id @default(autoincrement())
  stream     Stream       @relation(fields: [streamId], references: [id])
  streamId   Int
  value      String
  startedAt  DateTime
  createdAt  DateTime     @default(now())
  updatedAt  DateTime?    @updatedAt
  PointLabel PointLabel[]

  @@index([streamId, startedAt], name: "streamId_startedAt")
}

model Label {
  id         Int          @id @default(autoincrement())
  name       String       @unique
  createdAt  DateTime     @default(now())
  updatedAt  DateTime?    @updatedAt
  PointLabel PointLabel[]
}

model PointLabel {
  point     Point     @relation(fields: [pointId], references: [id])
  pointId   Int
  label     Label     @relation(fields: [labelId], references: [id])
  labelId   Int
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt

  @@id([pointId, labelId])
}
